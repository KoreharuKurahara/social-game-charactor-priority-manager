# 要件定義書

## 概要

けものフレンズ3の未所持キャラクターに対して優先度を設定し、取得優先順位を管理するWebアプリケーション。既存のGoogleスプレッドシートのデータを活用し、Google Apps Scriptで実装する。

## 要件

### 要件1: 未所持キャラクター表示機能

**ユーザーストーリー:** プレイヤーとして、未所持のキャラクターのみを一覧表示したい。これにより、取得すべきキャラクターを効率的に把握できる。

#### 受入基準

1. WHEN アプリを起動した時 THEN システムは「所持」列がFALSEのキャラクターのみを表示する
2. WHEN キャラクター一覧を表示する時 THEN システムは通し番号、フレンズ名、属性、HCを表示する
3. WHEN データが存在しない時 THEN システムは「未所持キャラクターがありません」というメッセージを表示する

### 要件2: 優先度設定・編集機能

**ユーザーストーリー:** プレイヤーとして、各キャラクターに優先度を設定・変更したい。これにより、限られたリソースを効率的に配分できる。

#### 受入基準

1. WHEN キャラクターの優先度を設定する時 THEN システムは1-10の数値で優先度を設定できる
2. WHEN 優先度を変更する時 THEN システムはスプレッドシートの「優先度」列を即座に更新する
3. IF 優先度が未設定の場合 THEN システムはデフォルト値5を表示する
4. WHEN 無効な値を入力した時 THEN システムはエラーメッセージを表示し、変更を拒否する

### 要件3: 優先度ソート機能

**ユーザーストーリー:** プレイヤーとして、優先度順にキャラクターを並び替えたい。これにより、次に取得すべきキャラクターを素早く特定できる。

#### 受入基準

1. WHEN 優先度ソートを選択した時 THEN システムは優先度の高い順（降順）でキャラクターを表示する
2. WHEN 同じ優先度のキャラクターが存在する時 THEN システムは通し番号順で二次ソートする
3. WHEN ソート条件を変更した時 THEN システムは即座に表示順序を更新する

### 要件4: 属性・入手方法フィルタ機能

**ユーザーストーリー:** プレイヤーとして、属性や入手方法でキャラクターを絞り込みたい。これにより、特定の条件に合うキャラクターを効率的に探せる。

#### 受入基準

1. WHEN 属性フィルタを選択した時 THEN システムは選択した属性のキャラクターのみを表示する
2. WHEN 入手方法フィルタを選択した時 THEN システムは該当ショップで入手可能なキャラクターのみを表示する
3. WHEN 複数フィルタを適用した時 THEN システムはAND条件で絞り込みを行う
4. WHEN フィルタをクリアした時 THEN システムは全ての未所持キャラクターを表示する

### 要件5: 入手方法表示機能

**ユーザーストーリー:** プレイヤーとして、各キャラクターの入手方法を確認したい。これにより、どこで取得できるかを把握できる。

#### 受入基準

1. WHEN キャラクター情報を表示する時 THEN システムは「6周年直前スペシャルショップ」「6周年記念グレートショップ」の対象可否を表示する
2. WHEN 入手方法が複数ある時 THEN システムは全ての入手方法を表示する
3. WHEN 入手方法が不明な時 THEN システムは「通常ガチャ」として表示する

### 要件6: データ同期機能

**ユーザーストーリー:** プレイヤーとして、アプリでの変更がスプレッドシートに反映されることを確認したい。これにより、データの整合性を保てる。

#### 受入基準

1. WHEN 優先度を変更した時 THEN システムは3秒以内にスプレッドシートを更新する
2. WHEN スプレッドシートが他の場所で更新された時 THEN システムはページリロード時に最新データを取得する
3. WHEN 更新に失敗した時 THEN システムはエラーメッセージを表示し、再試行オプションを提供する

### 要件7: 二分探索による優先度決定機能

**ユーザーストーリー:** プレイヤーとして、優先度が未設定のキャラクターに対して、既存キャラクターとの比較を通じて効率的に優先度を決定したい。これにより、大量のキャラクターでも素早く優先度を設定できる。

#### 受入基準

1. WHEN 優先度未設定のキャラクターを選択した時 THEN システムは二分探索アルゴリズムを開始する
2. WHEN 比較画面を表示する時 THEN システムは対象キャラクターと比較対象キャラクターを並べて表示する
3. WHEN 「こちらの方が欲しい」を選択した時 THEN システムは探索範囲を適切に絞り込む
4. WHEN 比較を完了した時 THEN システムは決定した優先度を自動的に設定する
5. IF 優先度が設定済みのキャラクターが1体以下の場合 THEN システムは手動入力モードに切り替える
6. WHEN 比較を中断した時 THEN システムは途中まで決定した優先度範囲を保存する

### 要件8: レスポンシブデザイン

**ユーザーストーリー:** プレイヤーとして、スマートフォンでもアプリを快適に使用したい。これにより、外出先でも優先度管理ができる。

#### 受入基準

1. WHEN スマートフォンでアクセスした時 THEN システムは画面サイズに適応したレイアウトを表示する
2. WHEN タッチ操作を行う時 THEN システムは適切なタッチターゲットサイズを提供する
3. WHEN 縦向き・横向きを切り替えた時 THEN システムは適切にレイアウトを調整する